<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset=utf-8>
    <title>test</title>
</head>
<body>

<link rel="stylesheet" media="all" href="./cutestrap.css">

<script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.26/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.7.0/vue-resource.js"></script>
<script src="./norch.js"></script>

<div id="app">
    <input v-model="queryinput" v-on:keyup="search">
    <p v-if="searchresult.length != 0">{{ searchresult.totalHits }} hits
      <span  v-for="test in searchresult.query[0].AND[0]">for query "{{ test[0] }}"</span>
    </p>
    <h2>Filters</h2>
    <ul v-if="searchresult.categories.length != 0">
      <li v-for="filters in searchresult.categories[0].value">
        {{{ filters.value }}} - {{{ filters.key }}}
      </li>
    </uL>	
    <h2>Results</h2>
    <ul v-if="searchresult.hits.length != 0">
      <li v-for="items in searchresult.hits">
        {{{ items.document.title }}}
      </li>
    </ul>
  <p v-if="searchresult.length != 0">Full JSON.ingredients: {{ searchresult.categories[0].value | json }}</p>
  <p v-if="searchresult.length != 0">Full JSON: {{ searchresult | json }}</p>
</div>

<script>
var vm = new Vue({
    el: '#app',
    data: {
        searchresult: [],
        queryinput: 'gulrotkake'
    },
    methods: {
        search: function() {

            var queryinput = this.queryinput.trim().toLowerCase();
            console.log('queryinput undef: ' + queryinput);

            // query definition
            var q = {};
            q['query'] = [{'AND': [{'*': [queryinput] }]}];
            q['categories'] = [{field: 'ingredients'}];
            console.log('q object: ' + JSON.stringify(q, null, 4));
            // JSON stringify query object
            q = JSON.stringify(q);
            console.log('Stringify q: ' + JSON.stringify(q, null, 4));
            // URI encode query object
            q = encodeURIComponent(q);
            console.log('URIencode q: ' + JSON.stringify(q, null, 4));
            var url = 'http://oppskrift.klemespen.com:3030/';
            var endpoint = 'search?q=';

            // GET request
            this.$http.get(url + endpoint + q, function (data) {
            //this.$http.get('http://oppskrift.klemespen.com:3030/search?q=%7B%22query%22%3A%7B%22AND%22%3A%5B%7B%22*%22%3A%5B%22' + queryinput + '%22%5D%7D%5D%7D%7D', function (data) {
                // set data on vm
                this.$set('searchresult', data);
                //console.log(data);
            }).catch(function (data, status, request) {
                // handle error
            })
        }
    }
})
</script>
</body>
</html>


